#!/bin/bash

BIN_PATH=$(dirname $(readlink -fn $0))
source $BIN_PATH/utils

isValidCLIRunDir
loadBuildEnvironment $UI_DEV_DIR
setSmsv2Path $UI_DEV_DIR

USE_NEW_TARBALL=true

while getopts "e" flag
do
  case $flag in
    e) USE_NEW_TARBALL=false;;
  esac
done

if [ $USE_NEW_TARBALL == true ]; then
  WD=${PWD}
  cd ${UI_DEV_DIR}/$SMSV2_PATH
  TARBALL=`ls *.tgz`
  end=${#TARBALL}-4
  CURRENT_SMS=${TARBALL:0:${end}}

  cd ${WD}
  rm -fr ${CURRENT_SMS}
  tar -zxf ${UI_DEV_DIR}/$SMSV2_PATH/${TARBALL}
else
  if [ $(ls | grep smsv2-D | wc -l) -gt 1 ]; then
    echo "Which one?"
    ls -hl smsv2-D*
    exit 1
  fi

  CURRENT_SMS=`ls | grep smsv2-`
fi

cleanup
${CURRENT_SMS}/VPlexcli --cli-directory cli -s 51111
